// === BACKEND ENDPOINT (Yandex Cloud Function) ===
const FUNCTION_URL = "https://functions.yandexcloud.net/d4e1po7m6l0nno0u1c5h";


/* =========================================================
   Persist form state (localStorage)
========================================================= */
const FORM_STATE_KEY = "ft-bank-reg-form-state:v1";

function readState() {
  try {
    const raw = localStorage.getItem(FORM_STATE_KEY);
    return raw ? JSON.parse(raw) : null;
  } catch (_) {
    return null;
  }
}

function writeState(state) {
  try {
    localStorage.setItem(FORM_STATE_KEY, JSON.stringify(state));
  } catch (_) {}
}

function clearState() {
  try {
    localStorage.removeItem(FORM_STATE_KEY);
  } catch (_) {}
}

function captureFormState(formEl) {
  const state = {};
  const els = formEl.querySelectorAll("input, select, textarea");
  els.forEach((el) => {
    if (!el.name) return;

    if (el.type === "checkbox") {
      state[el.name] = !!el.checked;
    } else if (el.type === "radio") {
      if (el.checked) state[el.name] = el.value;
    } else {
      state[el.name] = el.value;
    }
  });
  return state;
}

function applyFormState(formEl, state) {
  if (!state) return;
  const els = formEl.querySelectorAll("input, select, textarea");
  els.forEach((el) => {
    if (!el.name) return;
    if (!(el.name in state)) return;

    if (el.type === "checkbox") {
      el.checked = !!state[el.name];
    } else if (el.type === "radio") {
      el.checked = String(state[el.name]) === String(el.value);
    } else {
      el.value = state[el.name];
    }

    // важный момент: дергаем change, чтобы все зависимые блоки (другое/таймзона/описания) восстановились корректно
    el.dispatchEvent(new Event("change", { bubbles: true }));
    el.dispatchEvent(new Event("input", { bubbles: true }));
  });
}

function debounce(fn, wait = 400) {
  let t = null;
  return (...args) => {
    if (t) clearTimeout(t);
    t = setTimeout(() => fn(...args), wait);
  };
}
/* =========================================================
   Telegram WebApp
========================================================= */

/* =========================================================
   Platform context: Telegram / VK
========================================================= */
const APP_CONTEXT = {
  platform: "web",
  tg: null,
  vk: null,
};

// Telegram
try {
  const tg = window.Telegram?.WebApp;
  if (tg) {
    APP_CONTEXT.platform = "telegram";
    APP_CONTEXT.tg = {
      initData: tg.initData || "",
      initDataUnsafe: tg.initDataUnsafe || {},
      user: tg.initDataUnsafe?.user || null,
      start_param: tg.initDataUnsafe?.start_param || "",
    };
    tg.ready();
    try { tg.expand(); } catch (_) {}
  }
} catch (_) {}

// VK
async function initVK() {
  try {
    // vkBridge can be loaded from CDN in index.html
    const vkBridge = window.vkBridge;
    if (!vkBridge) return;

    await vkBridge.send("VKWebAppInit");
    APP_CONTEXT.platform = "vk";

    // launch params from URL
    const qs = window.location.search ? window.location.search.replace(/^\?/, "") : "";
    APP_CONTEXT.vk = { launchParamsRaw: qs };

    // user info (best effort)
    try {
      const info = await vkBridge.send("VKWebAppGetUserInfo");
      APP_CONTEXT.vk.user = info;
    } catch (_) {}
  } catch (e) {
    // if init fails, keep platform as web/telegram
  }
}
initVK();
const tg = window.Telegram?.WebApp;
if (tg) {
  tg.ready();
  try { tg.expand(); } catch (_) {}

// Yandex Cloud Function endpoint (замени на свой URL)
}

/* =========================================================
   Directions & tracks (from IT.csv / Non-IT.csv) — FULL TEXT
========================================================= */
const IT_DIRECTIONS = [
  {
    name: "Системный анализ",
    tracks: [
      {
        value: "it_1",
        label: "Аналитик DWH",
        description: `Что предстоит делать:
●        Собирать и анализировать требования потребителей данных
●        Загружать данные из систем-источников в платформы данных, описывать данные
●        Рассчитывать метрики, следить за качеством данных
●        Делиться идеями по развитию инструментов платформы данных
Необходимые навыки:
●        Уверенное знание SQL на уровне написания сложных запросов (оконные функции, подзапросы)
●        Понимание принципов функционирования хранилищ данных
Желательно: 
●       Базовое знание языка программирования (желательно Python).
Стажировка будет актуальна:
●        Как студентам профильных вузов, так и выпускникам онлайн-школ`,
      },
      {
        value: "it_2",
        label: "Системный аналитик",
        description: `Что предстоит делать:
●        Анализировать и уточнять бизнес- и системные требования, выстраивать процессы
●        Проектировать и документировать новые фичи
●        Взаимодействовать с коллегами и внешними командами для реализации интеграционных решений
●        Сопровождать и поддерживать текущие системы
Необходимые навыки:
●        Знание способов выявлений требований
●        Базовое знание различных способов интеграций и типов архитектур
●        Базовое знание нотаций UML и BPMN
●        Базовое знание SQL (Select, Join), умение писать простые вопросы
Стажировка будет актуальна:
●        Как студентам профильных вузов, так и выпускникам онлайн-школ
●        Кандидатам только из Москвы`,
      },
    ],
  },
  {
    name: "Data Scientist",
    tracks: [
      {
        value: "it_3",
        label: "Data Scientist (REI-132)",
        description: `Команда: 
Моделирования розничных рисков

Описание команды:
Наша команда занимается построением и внедрением моделей оценки рисков для розничного сегмента. Наши модели участвуют в критически важных процессах: расчёт резервов, кредитный скоринг, персонализация предложений и другие бизнес-кейсы. У нас реальные задачи с высокой бизнес-востребованностью, большими объемами данных, мы ценим инженерный подход к работе.

Мы вам доверим:
— Собирать, анализировать и обрабатывать данные;
— Разрабатывать модели, помогающие в оценке рисков с использованием внутренних и внешних данных;
— Разрабатывать модели для регуляторных целей ПВР/IFRS9;
— Строить модели для разнообразных бизнес-задач банка;
— Участвовать в создании пайплайнов построения моделей (от сбора данных до выведения в продакшн).

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— Имеет образование в области математики, прикладной математики, науки о данных, компьютерных наук, искусственного интеллекта, машинного обучения и смежных областях;
— Знание английского языка на уровне Intermediate и выше;
— Владеет Python на средний уровне;
— Обладает опытом в области классического машинного обучения (Classic Machine Learning) и анализа данных (Data Analysis).

Будет плюсом:
 —  Владение SQL на начальном уровне;
—  Навык настройки и работы с инфраструктурой (DevOps).`,
      },
      {
        value: "it_4",
        label: "Data Scientist (REI-129)",
        description: `Команда: 
Управление жизненныи циклом клиента

Описание команды:
Команда развивает сервисы по открытию счетов новым и действующим клиентам банка, отвечает за удобный процесс с комплексной проверкой личности и данных 

Мы вам доверим:
— работа с алгоритмами машинного обучения, построение и тестирование предиктивных моделей;
— автоматизация отчетности через AirFlow;
— усовершенствование автоматических ответов в чате клиентам;
— развитие распознавания документов.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 35 часов в неделю (гибридный формат);
— образование по специальности бизнес информатика, програмная инженерия, компьютерные науки, прикладная математика и информатика , програмирование и смежные технические специальности;
— знает английский язык на уровне Intermediate и выше;
— владеет Python и SQL на продвинутом уровне;
— разбирается в статистике, теории вероятности и методах проверки гипотез;
— опыт написания классических моделей.

Будет плюсом:
 — учебный опыт разработки приложений; 
— реализация проектов с применением вайбкодинга;
— использование AI и LLM в учебных проекта;
— опыт написания генеративных моделей.`,
      },
    ],
  },
  {
    name: "Data Analyst",
    tracks: [
      {
        value: "it_5",
        label: "Data Analyst (REI-125)",
        description: `Команда: 
Разработки антифрод data-сервисов

Описание команды:
Мы создаём и поддерживаем data-продукты для антифрод-систем — от сбора и анализа данных до решений на основе искусственного интеллекта. Наша цель — защита клиентов от мошенничества и автоматизация процессов подразделения. Мы улучшаем алгоритмы детекции подозрительных транзакций и клиентов, а также разрабатываем самоадаптируемые решения, которые минимизируют участие человека в обработке обращений и реагировании на новые схемы мошенничества.

Мы вам доверим:
— Собирать, анализировать и обрабатывать данные;
— Настраивать автоматическую отчётность и создавать дашборды для анализа данных;
— Искать и оценивать источники новых и ценных данных, которые могут быть полезны для продукта и повышения эффективности детекции рисков;
— Исследовать гипотезы по улучшению продукта в рамках направления антифрода и автоматизировать процессы.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— имеет образование в области прикладной математики, прикладной информатики, физики, социологии или смежном направлении;
— владеет Excel и SQL на среднем уровне;
— владеет инструментами визуализации отчетности (BI); 
— обладает знаниями в области математической статистики;
— отличается высокой аккуратностью в работе с данными;
— обладает навыком коммуникации и легко налаживает контакт с коллегами из разных команд.

Будет плюсом:
— знание Python на начальном уровне.`,
      },
      {
        value: "it_6",
        label: "Data Analyst (REI-110)",
        description: `Команда: 
Команда по работе с клиентами среднего бизнеса

Описание команды:
Мы — команда, которая работает с клиентами из сегмента среднего бизнеса. В рамках трансформации SDB (Self-Driving Bank) мы экспериментируем с новым подходом к обслуживанию: внедряем многослойную модель, где клиент может взаимодействовать с банком через разные каналы — цифровой, гибридный и личный. Это позволяет персонализировать поддержку под потребности каждого клиента и эффективно распределять время и ресурсы менеджеров.

Мы вам доверим:
— Внедрять новую модель продаж и настраивать взаимодействие между всеми каналами: цифровым, гибридным, портфельным и личным, чтобы они работали как единая система;
— Анализировать, какие клиенты готовы перейти из одного канала обслуживания в другой — например, из личного общения в цифровой формат, и наоборот;
— Участвовать в разработке новых решений для управления продажами с использованием прототипов, вайбкодинга и экспериментов;
— Интегрировать AI-инструменты, которые помогут менеджерам лучше понимать потребности клиентов и предлагать релевантные продукты;
— Собирать и структурировать обратную связь от клиентов и менеджеров для постоянного улучшения продуктов и сервисов.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (очный формат);
— имеет образование в области прикладной математики, прикладной информатики, физики, бизнес информатики, компьютерных наук или смежном техническом направлении;
— знает английский язык на уровне Intermediate и выше;
— владеет Excel и SQL на среднем уровне;
— имеет опыт использования AI в проектах, разбирается в LLM и составлении промтов;
— умеет разбираться в сложных процессах и проактивен.

Будет плюсом:
— знание Python на начальном уровне.`,
      },
      {
        value: "it_7",
        label: "Data Analyst (REI-123)",
        description: `Команда: 
Управление жизненныи циклом клиента 

Описание команды:
Наша цель — создание новой единой мастер-системы для хранения и управления клиентскими данными и процессами обслуживания юридических лиц и ИП.

Мы вам доверим:
— построение сквозной аналитики процессов команд
— поиск гипотиз для улучшения джобов клиентов
— разрабатывать систему метрик для продукта

Наш идеальный кандидат: 
— живет в Москве и готов работать от 35 часов в неделю (гибридный формат);
— имеет образование в области бизнес информатики, прикладной математики и информатики, програмной инженерии, компьютерный наук или смежном техническом направлении;
— знает английский язык на уровне Intermediate и выше;
— владеет Python и SQL на продвинутом уровне;
— разбирается в статистике, теории вероятности и методах проверки гипотез;

Будет плюсом:
— использование AI и LLM в учебных проектах;
— понимание принципов ML.
`,
      },
    ],
  },
];

const NON_IT_DIRECTIONS = [
  {
    name: "Sales and Customer service",
    tracks: [
      {
        value: "nonit_1",
        label: "Products Sales",
        description: ``,
      },
      {
        value: "nonit_2",
        label: "Депозитарное обслуживание (выплата доходов по ценным бумагам) REI-118",
        description: `Команда: 
Отдел депозитарного обслуживания

Описание команды:
Мы оказываем клиентам депозитарные услуги по получению доходов по ценным бумагам в пользу Депонента, а также услуги по предоставлению информации, распространяемой Центральным депозитарием, эмитентами, Регистраторами и иными депозитариями для владельцев ценных бумаг

Мы вам доверим:
— подготовку писем и ответов клиентам по запросам о прошедших корпоративных действиях и произведенных выплатах;
— отслеживание своевременности подачи инструкций в вышестоящие депозитарии и регистраторы, а также проверку статусов поданных инструкций;
— мониторинг качества данных о предстоящих корпоративных действиях в системе депозитарного учёта.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— имеет образование по направлению экономика, финансы или смежные;
— знает английский язык на уровне Intermediate;
— имеет средний уровень владения Excel`,
      },
      {
        value: "nonit_3",
        label: "Развитие цифроых банковских решений (Products Sales) REI-114",
        description: `Команда: 
Продаж и развития продуктов рынка капитала

Описание команды:
Мы — команда, которая работает с продуктами, лежащими в самом сердце клиентского сервиса и бизнес-процессов: ВЭД, сбор выручки, РКО, управление ликвидностью и другие решения, востребованные среди корпоративных клиентов. Мы тесно взаимодействуем с клиентскими менеджерами, продуктовыми командами и техническими специалистами, чтобы запускать новые продукты, масштабировать успешные кейсы, обучать коллег и предлагать клиентам именно те решения, которые им нужны. В нашей работе важен комплексный подход, аналитика спроса и предложения, а также развитие лидерских и экспертных навыков.

Мы вам доверим:
— Развивать продажи транзакционных продуктов на закреплённой территории;
— Запускать совместно с продуктовыми командами новые решения, формировать спрос и развивать рынок;
— Обучать и вовлекать клиентских менеджеров, чтобы они могли уверенно предлагать продукты;
— Проводить вебинары, тренинги и презентации для донесения ценности продуктов до клиента;
— Масштабировать успешные кейсы, внедряя лучшие практики продаж по всей сети.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (очный формат);
— имеет образование в области развития цифровых продуктов и сервисов, экономике, менеджменте проектов и смежном;
— знает английский язык на уровне Intermediate и выше;
— владеет Excel на среднем уровне;
— умеет работать с Power Point и Figma;
— умеет находить общий язык с разными командами и клиентами;
— готов брать ответственность и инициативу.

Будет плюсом:
 — участие в хакатонах, кейс-чемпионатах, конференциях или учебных проектах;
— интерес к развитию в управлении продуктом и проектами;
— использование AI и LLM в учебных проектах.`,
      },
      {
        value: "nonit_4",
        label: "Корпоративное обслуживание REI-116",
        description: `Команда: 
Корпоративного обслуживания

Описание команды:
Мы работаем с крупнейшими клиентами банка, юридическими лицами. Принимаем документы, обрабатываем их для дальнейшей работы с юристами, исполняем запросы клиентов, как дистанционно, так в оффлайн формате. Через наше подразделение проходят практически все продукты банка, это отличная возможность погрузится в банковскую деятельность и понять, куда двигаться дальше.

Мы вам доверим:
— Работа с внешними ключевыми клиентами, консультирование и заключение крупных сделок; 
— Оцифровку и разбор поступающих документов как от внешних клиентов, так и от внутренних стейкхолдеров — кредитных экспертов, торгового финансирования, финансовых институтов и других подразделений;
— Обеспечивать точность и оперативность обработки документации на всех этапах;
— Взаимодействовать с различными командами для уточнения деталей и согласования процессов;
— Строить и улучшать процессы обработки документов, делая их более эффективными и клиентоориентированными.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (очный формат);
— студент или выпускник по специальности финансы, экономика, юриспруденция и смежных направлений;
— знает английский язык на уровне Intermediate  и выше;
— владеет Excel на среднем уровне;
— обладает навыками тайм-менеджмента и умеет расставлять приоритеты;
— умеет работать в команде и эффективно взаимодействовать с коллегами из разных подразделений.

Будет плюсом:
 — понимает принципы работы с юридическими лицами;
— владение другими иностранными языками.`,
      },
      {
        value: "nonit_5",
        label: "Работа с корпоративными клиентами на рынках капитала REI-115",
        description: `Команда: 
Отдел продаж корпоративным клиентам на рынках капитала

Описание команды:
Мы занимаемся продажами финансовых инструментов (FX, деривативы, размещение ликвидности) для корпоративных клиентов Среднего, Международного и Крупного сегментов бизнеса. Фокусируемся на развитии цифровых продаж инструментов через платформу ("Обмен валют") в онлайн банке. Создаем вместе с продуктовой командой один из самых удобных клиенских сервисов в стране. В 2026м году среди основных фокусов будет внедрение sales AI агентов, которые смогут автономно решать большую часть рутинных задач из процесса продаж.

Мы вам доверим:
— изучать механизмы и модели ценообразования по различным финансовым инструментам (включая FX/Rates derivatives, FX Spot и другие);
— взаимодействовать с корпоративными и институциональными клиентами, выявлять потребности и формировать на их основе продуктовые решения, коммуницировать с клиентами для решения базовых вопросов;
— участвовать в сделках от этапа origination до execution;
— участвовать в сделках и проектах крупных эмитентов по выкупу ценных бумаг: собирать заявки и вести коммуникацию;
— готовить индикативные предложения по финансовым инструментам;
— создавать креативные презентации, связанные с продуктами, аналитикой и продажами;
— помогать команде наполнять контентом и контекстом AI-агентов.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 35 часов в неделю (очный формат);
— студент или выпускник по специальности финансы, экономика и смежных направлений;
— знает английский язык на уровне Advanced (необходим навык чтения и написания текста, а также устной речи);
— имеет продвинутый уровень владения Excel (сводные таблицы, ВПР);
— имеет высокий навык коммуникации и многозадачности;
— хочет развиваться в направлении продаж и работать с клиентами;
— базовые знания рынка капитала.

Будет плюсом:
 — опыт работы с Figma;
—навык промтинга, работы с AI и LLM;`,
      },
    ],
  },
  {
    name: "Внутренний аудит (Audit)",
    tracks: [
      {
        value: "nonit_6",
        label: "Внутренний аудит рынка капитала и ценных бумаг REI-117",
        description: `Команда: 
Аудит операций на рынках капитала

Описание команды:
Мы даем акционерам и руководству банка гарантии того, что внутренние процессы выстроены и работают исправно. В зону нашей ответственности входят брокерские операции, депозитарий, специализированный депозитарий (паевые инвестиционные фонды), деривативные продукты, казначейство и много других сложных и интересных областей, многие из которых в настоящий момент являются приоритетными направлениями развития нашего банка.

Мы вам доверим:
— Проводить предварительный анализ зоны аудита: изучать события операционных рисков, регуляторные и внутренние требования, участвовать в интервью и отрисовывать схемы процессов;
— Работать с данными с использованием LLM и AI агентов: запрашивать и обрабатывать данные из различных источников, выполнять фильтрацию, агрегацию и расчеты;
— Анализировать материалы, полученные в ходе аудита: проверять данные, изучать первичные документы по сделкам, а также аналитические материалы, включая отчеты по соблюдению лимитных требований;
— Самостоятельно презентовать результаты проверок менеджменту банка; 
— Изучать практики конкурентов, лучшие отраслевые подходы и привносить их в рамках рекомендаций командам: анализировать отчеты консалтинговых компаний, открытые документы и материалы регуляторов;
— Подготавливать итоговый отчет по результатам проведённой работы на английском языке.


Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности финансы и смежных направлений;
— знает английский язык на уровне Upper-Intermediate и выше и умеет составлять официальные запросы на нем;
—  владеет продвинутым Excel и базовыми навыками SQL;
—  имеет опыт работы с объёмными документами (100+ страниц);
—  обладает высоким уровнем тайм-менеджмента;
— умеет уверенно отстаивать свою точку зрения, сохраняя конструктивный подход.

Будет плюсом:
 — базовые знания управления проектами.`,
      },
    ],
  },
  {
    name: "Корпоративное обучение (Methodology)",
    tracks: [
      {
        value: "nonit_7",
        label: "Методолог в команду корпоративного обучения REI-119",
        description: `Команда: 
Проведение и методология обучения сотрудников

Описание команды:
Команда создает образовательные продукты и проводит различные обучающие мероприятия для всех сотрудников банка. Мы помогаем коллегам развивать их профессиональные и менеджерские компетенции, создаем классный опыт корпоративного обучения.

Мы вам доверим:
— Проектирование и верстку лендингов для различных программ обучения;
— Участие в разработке AI-тренажёров для обучения и развития сотрудников;
— Переработку и создание обучающего контента — например, превращение материалов в one-pagers и другие удобные форматы;
— Разработку тестов и опросов для оценки эффективности обучающих материалов;
— Первичное взаимодействие с внешними провайдерами — поиск, сбор и анализ предложений;
— Участие в проведении исследований для выявления потребностей и эффективности обучающих продуктов.


Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности менеджмент в образовании, проектирование образовательных программ, методология профессионального образования, педагогического проектирования, социология, психология, управление персоналом, педагогика и смежных направлений;
— знает английский язык на уровне Intermediate и выше;
— владеет навыком работы в иллюстраторах, Figma и другие;
— обладает грамотной устной и письменной речью;
— умеет искать и анализировать информацию из различных источников;
— имеет навыки работы с искуственным интеллектом и понимает алгоритм работы с ними — включая написание промптов и использование ИИ-инструментов для обработки и анализа информации..

Будет плюсом:
—  Excel на начальном уровне;`,
      },
    ],
  },
  {
    name: "Продуктовый менеджмент (Product Management)",
    tracks: [
      {
        value: "nonit_8",
        label: "Product Management REI-109",
        description: `Команда: 
Команда инвестиций для физических лиц

Описание команды:
Мы делаем инвестиции доступными с помощью мобильного приложения, простыми и понятными для каждого — вне зависимости от финансовой цели. Мы развиваем два ключевых направления: брокерское обслуживание для клиентов, которые хотят управлять своими вложениями самостоятельно, и доверительное управление — для тех, кто предпочитает доверить финансы профессионалам.

Мы вам доверим:
— анализировать обратную связь клиентов по инвестиционным продуктам — из call-центра, опросов и других источников — и выделять основные боли и точки роста;
— участвовать в клиентских исследованиях: готовить опросы, проводить интервью, собирать и структурировать данные;
— анализировать предложения конкурентов и отслеживать тренды на рынке инвестиционных продуктов;
— изучать клиентский путь в инвестиционных продуктах, выявлять слабые места и точки улучшения;
— генерировать гипотезы и готовить предложения по улучшению клиентского опыта на основе аналитики и исследований.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 30 часов в неделю (гибридный формат);
— студент или выпускник направления бизнес-информатика, менеджмент, управление проектами, экономика, финансы, маркетинг и смежных;
— знает английский язык на уровне Intermediate и выше;
—  владеет Excel на среднем уровне;
—  владеет PowerPoint на продвинутом уровне;
— умеет структурно мыслить;
— проактивен и умеет уверенно отстаивать свою точку зрения, сохраняя конструктивный подход.

Будет плюсом:
— понимание фондового рынка;
— опыт работы в продуктовой команде; 
— участие в кейс чемпионатах, хакатонах или других проектах.`,
      },
      {
        value: "nonit_9",
        label: "",
        description: ``,
      },
      {
        value: "nonit_10",
        label: "",
        description: ``,
      },
      {
        value: "nonit_11",
        label: "",
        description: ``,
      },
    ],
  },
  {
    name: "Риск-аналитика (Analytics)",
    tracks: [
      {
        value: "nonit_12",
        label: "Портфельная риск-аналитика REI-108",
        description: `Команда: 
 Отдел портфельного менеджмента и аналитики

Описание команды:
Команда портфельного риск-менеджмента занимается анализом уровня риска и сегментацией активного кредитного портфеля физ.лиц, выявляет проблемные зоны и потенциальные зоны роста, формирует правила кредитования клиентов, обеспечивающие приемлемый уровень риска для банка и наиболее удобный и быстрый процесс рассмотрения заявок для клиентов. 

Мы вам доверим:
— Анализ розничного кредитного портфеля и тенденций его развития: работу с ежемесячными отчетами, мониторинг ключевых показателей;
— Идентификацию рисков розничного кредитования: выработку предложений по оптимизации условий и процессов кредитования физических лиц, а также контроль за их реализацией;
— Подготовку ежемесячных, ежеквартальных и ежегодных аналитических обзоров и презентаций для руководства Банка;
— Участие в согласовании предложений по развитию розничных кредитных продуктов и изменению процессов кредитования, а также подготовку аналитических заключений для Кредитного комитета Банка.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности экономика, математика и технических дисциплин;
— знает английский язык на уровне Upper-Intermediate и выше;
— имеет навыки работы в Excel на продвинутом уровне (сводные таблицы, ВПР, макросы) и базовыми знаниями Power BI;

Будет плюсом:
— обладает навыком программирования Python (уровень аналитика);
— обладает основами Data Scientist (математическая статистика, моделирование и тд)`,
      },
    ],
  },
  {
    name: "Соотвествие и контроль (Compliance)",
    tracks: [
      {
        value: "nonit_13",
        label: "Комплаенс-контроль на финансовых рынках REI-101",
        description: `Команда: 
Команда комплаенс-контроля на финансовых рынках

Описание команды:
Наша команда отвечает за систему внутреннего контроля, которая помогает банку соответствовать локальным требованиям и международным стандартам на финансовых рынках. Мы следим, чтобы новые продукты и услуги были законны, проводим мониторинг и анализ сделок на рынке ценных бумаг, выявляем конфликты интересов и регуляторные риски.

Мы вам доверим:
— Проведение оценки соответствия деятельности дочерней компании требованиям законодательства, корпоративным и международным стандартам;
— Выявление и анализ комплаенс-рисков для предотвращения нарушений и санкций;
— Подготовку и обновление внутренней нормативно-документальной базы;
— Проведение анализа бизнес-процессов и сделок на предмет комплаенс-рисков;
— Работу с обращениями клиентов и участие в расследованиях потенциальных нарушений;
— Консультирование сотрудников по вопросам применения правовых и этических норм;

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (очный формат);
— образование в области корпоративных и международных финансов, финансового менеджмента, комплаенса и профилактики правовых рисков, экономическая безопасность или смежных направлениях;
— знает английский язык на уровне Upper-Intermediate и выше;
— владеет MS Excel на продвинутом уровне (сводные таблицы, ВПР, макросы);
— умеет правильно интерпретировать законодательные акты и составлять документы;
— нацелен на результат, умеет анализировать большие объёмы данных и погружаться в сложные процессы;
— проходит обучение по корпоративным и международным финансам, финансовому менеджменту, комплаенсу и профилактике правовых рисков или смежным направлениям.

Будет плюсом:
 — имеет знания SQL и Python на базовом уровне.`,
      },
      {
        value: "nonit_14",
        label: "Антикорупционный комплаенс REI-100",
        description: `Команда: 
Команда соответствия внутрикорпоративным стандартам

Описание команды:
Команда занимается управлением рисками конфликта интересов, противодействием коррупции и взяточничеству, а также обеспечивает соблюдение антикоррупционных требований в ключевых бизнес-процессах. Основные направления работы включают контроль за подарками и приглашениями, спонсорством, благотворительностью, закупками и взаимодействием с агентами.

Мы вам доверим:
— Участвовать в оценке конфликтов интересов и разработке мер по их минимизации;
— Вести и актуализировать профили сотрудников, контролировать исполнение их антикоррупционных обязательств;
— Согласовывать договоры с учетом антикоррупционных требований;
— Принимать участие в рассмотрении мероприятий, подарков и приглашений в рамках соблюдения политики компании.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 35 часов в неделю (очный формат);
— образование по направлению: юриспруденция, право, комплаенс-контроль, экономическая безопасность и смежных направлениях;
— понимание что такое комплаенс и зачем он нужен в коммерческой организации;
— имеет навыки работы в MS Excel и PowerPoint на продвинутом уровне;
— знает английский язык на уровне Intermediate и выше;
— обладает аналитическим мышлением, способностью быстро обучаться и погружаться в детали;
— умеет структурировать большое количество информации;
— нацелен на результат и развитие в сфере комплаенс.

Будет плюсом:
 — понимание как работают алгоритмы и их отличие от LLM;
 — опыт подготовки технических заданий для автоматизаций.`,
      },
    ],
  },
  {
    name: "Финансовая аналитика (Finance & Consulting)",
    tracks: [
      {
        value: "nonit_15",
        label: "Финансовый анализ и планирование REI-103",
        description: `Команда: 
Отдел финансового планирования и анализа 

Описание команды:
Мы анализируем доходность, участвуем в разработке бюджета и оцениваем тарифы текущих продуктов, а также участвуем в запуске новых. Наша цель — вносить свой вклад в устойчивый рост наших продуктов через предоставление точных финансовых моделей и качественной финансовой аналитики.

Мы вам доверим:
— Изучать текущие финансовые модели розничных продуктов банка;
— Участвовать в процессе бюджетирования и планирования показателей розничных продуктов.
— Строить статистические модели продуктов и профили поведения клиентов.
— Работать с базами данных и совместно с продуктовыми командами анализировать доходность розничных продуктов банка.
— Поддерживать существующие отчеты и участвовать в разработке новых аналитических отчетов.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности экономика, математическая статистика, финансы или смежное;
— знает английский язык на уровне Intermediate и выше;
— имеет навыки работы в MS Excel на продвинутом уровне (Power Query и макросы);
— обладает базовыми знаниями SQL (Select, Joins);
— имеет развитое системное мышление и обладает аналитическим складом ума.

Будет плюсом:

— владеет программированием на Python; `,
      },
      {
        value: "nonit_16",
        label: "Автоматизация управленческой отчетности REI-104",
        description: `Команда: 
Отдел управления расходами

Описание команды:
Наша команда занимается подготовкой управленческой отчетности по расходам Банка, обеспечением точности и актуальности данных, автоматизацияй процессов, а также методологическим сопровождением отчетных процессов.

Мы вам доверим:
— Участвовать в ежемесячном закрытии: обновлять финансовые модели и помогать в подготовке управленческой отчетности;
— Работать с данными: заниматься их загрузкой, проверкой, анализом и обработкой;
— Участвовать в проектах по оптимизации и автоматизации процессов в том числе через использование LLM;
— Взаимодействовать с командой разработки при формировании технических заданий для автоматизации и улучшения процессов.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности экономика, финансы или смежное;
— готов работать от 25 часов в неделю (гибридный формат);
— имеет образование в области экономики, финансов и смежных направлений;
— знает английский язык на уровне Intermediate и выше;
— имеет навыки работы в Excel на продвинутом уровне (сводные таблицы, ВПР, Power Query);
—  владеет SQL на базовом уровне;
— имеет навыки промптинга для работы с LLM; 
— обладает аналитическим складом ума и проактивен.

Будет плюсом:
— владеет программированием на Python; `,
      },
      {
        value: "nonit_17",
        label: "Стратегия и развитияе корпоративных банковских продуктов REI-106",
        description: `Команда: 
Команда стратегии и развития корпоративных банковских продуктов

Описание команды:
Команда бизнес развития и стратегии отвечает за разработку и реализацию стратегии корпоративно-инвестиционного бизнеса. Наша цель — постоянно повышать эффективность, прибыльность и конкурентоспособность корпоративного бизнеса. Мы отвечаем за анализ бизнес-результатов одного из бизнес сегментов, планирование и мониторинг бюджета, участвуем в постановке целей и в управлении эффективностью.

Мы вам доверим:
— Собирать и анализировать данные по рынку, продуктам и клиентам, используя открытые источники и внутренние данные банка;
— Выявлять точки роста и повышения эффективности работы команд;
— Участвовать в целепологании для продуктовых команд;
— Участие в рабочих встречах, брейнштормах и презентациях результатов работы.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности экономика, финансы, инвестиционный менеджмент, банковское дело, международные отношения и смежное;
— знает английский язык на уровне Intermediate и выше;
— владеет Excel, SQL и Python на среднем уровне;
— обладает аналитическим мышлением и стремлением к обучению;
— участвовал в кейс чемпионатах или имеет реелватный опыт работы / практики.
`,
      },
      {
        value: "nonit_18",
        label: "Подготовка и аналитика управленческой отчетности REI-102",
        description: `Команда: 
Команда управленческой отчетности

Описание команды:
Мы готовим управленческую отчетность и аналитику по банку, являемся бизнес-партнерами продуктовых команд и участвуем в оценке эффективности бизнес решений и выработке стратегического видения развития бизнес сегментов, продуктов и банка в целом

Мы вам доверим:
— участвовать в подготовке ежедневной и ежемесячной управленческой отчетности по результат сегментов корпоративного бизнеса, финансовых институтов, а также операций на рынках капитала;
— отвечать на запросы бизнеса по предоставляемым данным и отчетам (анализировать и объяснять динамику результата по сегменту, продукту, клиенту);
— принимать участие в запуске изменений в продуктовой линейке сегмента корпоративного бизнеса — предлагать изменения в отчеты, создавать новые, фокусируясь на основных задачах блока.

Наш идеальный кандидат: 
— живет в Москве и готов работать от 25 часов в неделю (гибридный формат);
— студент или выпускник по специальности экономика, финансы, банковское дело, международные отношения и смежное;
— знает английский язык на уровне Intermediate и выше;
— имеет навыки работы в MS Excel на среднем уровне (сводные таблицы, ВПР, макросы);
— обладает базовыми знаниями SQL (Select, Joins);
— владеет высоким уровнем коммуникаций и проактивен в решении задач.

Будет плюсом:
— владеет инсутрментами визуализации аналитики (BI);`,
      },
      {
        value: "nonit_19",
        label: "",
        description: ``,
      },
    ],
  },
  {
    name: "Юридическое сопровождение (Law & Legal )",
    tracks: [
      {
        value: "nonit_20",
        label: "",
        description: ``,
      },
    ],
  },
];

/* =========================================================
   DOM
========================================================= */
const form = document.getElementById("reg-form");

const emailErrorEl = document.getElementById("email-error");
const resultEl = document.getElementById("result");
const errorEl = document.getElementById("error");

const policyLink = document.getElementById("policy-link");
const policyText = document.getElementById("policy-text");


const city = document.getElementById("city");
const cityOtherBlock = document.getElementById("city_other_block");
const timezoneDiffBlock = document.getElementById("timezone_diff_block");

const educationDegree = document.getElementById("education_degree");
const gradYearBlock = document.getElementById("grad_year_block");
const graduationYear = document.getElementById("graduation_year");

const specialty = document.getElementById("specialty");
const specialtyOtherBlock = document.getElementById("specialty_other_block");

const internshipDirection = document.getElementById("internship_direction");

const onlineCoursesBlock = document.getElementById("online_courses_block");
const onlineCourses = document.getElementById("online_courses");
const onlineCourseYearBlock = document.getElementById("online_course_year_block");
const onlineCourseYear = document.getElementById("online_course_year");
const onlineCourseYearOtherBlock = document.getElementById("online_course_year_other_block");
const onlineCourseYearOther = document.getElementById("online_course_year_other");

const prioritiesBlock = document.getElementById("priorities_block");
const priority1 = document.getElementById("priority1");
const priority2 = document.getElementById("priority2");
const priority1Desc = document.getElementById("priority1_description");
const priority2Desc = document.getElementById("priority2_description");

/* =========================================================
   Helpers
========================================================= */
function setBlockVisible(el, isVisible) {
  el.style.display = isVisible ? "block" : "none";
}

function clearMessages() {
  resultEl.textContent = "";
  errorEl.textContent = "";
  emailErrorEl.style.display = "none";
  emailErrorEl.textContent = "";
}

function isValidEmail(email) {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(email).trim());
}

function resetSelect(select, placeholder) {
  select.innerHTML = "";
  const opt = document.createElement("option");
  opt.value = "";
  opt.textContent = placeholder;
  select.appendChild(opt);
}



function fillPrioritySelects(directionType) {
  // directionType: "IT" | "Бизнес"
  const source = directionType === "IT" ? IT_DIRECTIONS : NON_IT_DIRECTIONS;

  resetSelect(priority1, "— Выберите —");
  resetSelect(priority2, "— Выберите —");

  // Красивое разделение: направление -> треки (optgroup)
  source.forEach((dir) => {
    const tracks = (dir.tracks || []).filter(t => (t.label || "").trim().length > 0);

    const og1 = document.createElement("optgroup");
    og1.label = dir.name;

    const og2 = document.createElement("optgroup");
    og2.label = dir.name;

    tracks.forEach((t) => {
      const o1 = document.createElement("option");
      o1.value = t.value;
      o1.textContent = t.label;
      o1.dataset.description = t.description || "";
      og1.appendChild(o1);

      const o2 = document.createElement("option");
      o2.value = t.value;
      o2.textContent = t.label;
      o2.dataset.description = t.description || "";
      og2.appendChild(o2);
    });

    if (og1.children.length) priority1.appendChild(og1);
    if (og2.children.length) priority2.appendChild(og2);
  });

  // сброс описаний
  setBlockVisible(priority1Desc, false);
  setBlockVisible(priority2Desc, false);
  priority1Desc.textContent = "";
  priority2Desc.textContent = "";
}



function updatePriorityDescription(selectEl, descEl) {
  const opt = selectEl.options[selectEl.selectedIndex];
  const desc = opt?.dataset?.description || "";
  if (desc.trim()) {
    descEl.textContent = desc;
    setBlockVisible(descEl, true);
  } else {
    descEl.textContent = "";
    setBlockVisible(descEl, false);
  }
}

/* =========================================================
   Conditional logic (by Анкета.csv)
========================================================= */

// Citizenship -> Other
citizenship.addEventListener("change", () => {
  const isOther = citizenship.value === "Другое";
  setBlockVisible(citizenshipOtherBlock, isOther);
  if (!isOther) {
    const el = document.getElementById("citizenship_other");
    if (el) el.value = "";
  }
});

// City -> Other => city text + timezone diff
city.addEventListener("change", () => {
  const isOther = city.value === "Другой";
  setBlockVisible(cityOtherBlock, isOther);
  setBlockVisible(timezoneDiffBlock, isOther);
  if (!isOther) {
    const c = document.getElementById("city_other");
    const tz = document.getElementById("timezone_diff");
    if (c) c.value = "";
    if (tz) tz.value = "";
  }
});

// Education degree -> no higher => hide graduation year
educationDegree.addEventListener("change", () => {
  const noHigher = educationDegree.value === "Нет высшего образования";
  setBlockVisible(gradYearBlock, !noHigher);
  if (noHigher && graduationYear) graduationYear.value = "";
});

// Specialty -> Other
specialty.addEventListener("change", () => {
  const isOther = specialty.value === "Другое";
  setBlockVisible(specialtyOtherBlock, isOther);
  if (!isOther) {
    const s = document.getElementById("specialty_other");
    if (s) s.value = "";
  }
});

// Internship direction -> show priorities; if IT show online courses
internshipDirection.addEventListener("change", () => {
  const isIT = internshipDirection.value === "IT";
  const isBusiness = internshipDirection.value === "Бизнес";

  setBlockVisible(onlineCoursesBlock, isIT);

  // reset online courses on switching away from IT
  if (!isIT) {
    onlineCourses.value = "";
    onlineCourseYear.value = "";
    if (onlineCourseYearOther) onlineCourseYearOther.value = "";
    setBlockVisible(onlineCourseYearBlock, false);
    setBlockVisible(onlineCourseYearOtherBlock, false);
  }

  const showPriorities = isIT || isBusiness;
  setBlockVisible(prioritiesBlock, showPriorities);

  if (showPriorities) {
    fillPrioritySelects(internshipDirection.value);
  } else {
    resetSelect(priority1, "— Выберите —");
    resetSelect(priority2, "— Выберите —");
    setBlockVisible(priority1Desc, false);
    setBlockVisible(priority2Desc, false);
    priority1Desc.textContent = "";
    priority2Desc.textContent = "";
  }
});

// Online courses -> if selected and not "Не проходил(а)" => show year
onlineCourses.addEventListener("change", () => {
  const v = onlineCourses.value;
  const showYear = v && v !== "Не проходил(а)";
  setBlockVisible(onlineCourseYearBlock, showYear);

  if (!showYear) {
    onlineCourseYear.value = "";
    if (onlineCourseYearOther) onlineCourseYearOther.value = "";
    setBlockVisible(onlineCourseYearOtherBlock, false);
  }
});

// Course year -> Other => show input
onlineCourseYear.addEventListener("change", () => {
  const isOther = onlineCourseYear.value === "Другой";
  setBlockVisible(onlineCourseYearOtherBlock, isOther);
  if (!isOther && onlineCourseYearOther) onlineCourseYearOther.value = "";
});

// Priority descriptions
priority1.addEventListener("change", () => updatePriorityDescription(priority1, priority1Desc));
priority2.addEventListener("change", () => updatePriorityDescription(priority2, priority2Desc));

/* =========================================================
   Policy toggle
========================================================= */
if (policyLink && policyText) {
  policyLink.addEventListener("click", () => {
    const shown = policyText.style.display === "block";
    policyText.style.display = shown ? "none" : "block";
  });
}

/* =========================================================
   Submit
========================================================= */

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  clearMessages();

  const data = Object.fromEntries(new FormData(form).entries());

  // Минимальная строгая валидация ключевых полей анкеты
  if (!data.last_name?.trim()) return (errorEl.textContent = "Укажите Фамилию.");
  if (!data.first_name?.trim()) return (errorEl.textContent = "Укажите Имя.");

  if (!data.email?.trim() || !isValidEmail(data.email)) {
    emailErrorEl.textContent = "Введите корректный email.";
    emailErrorEl.style.display = "block";
    return;
  }

  if (!data.phone?.trim()) return (errorEl.textContent = "Укажите номер телефона.");
  if (!data.birth_date?.trim()) return (errorEl.textContent = "Укажите дату рождения.");

  if (!data.city) return (errorEl.textContent = "Выберите город проживания.");
  if (data.city === "Другой") {
    if (!data.city_other?.trim()) return (errorEl.textContent = "Укажите город проживания.");
    if (!data.timezone_diff) return (errorEl.textContent = "Выберите разницу во времени относительно Мск.");
  }

  if (!data.education_degree) return (errorEl.textContent = "Выберите степень образования.");
  if (data.education_degree !== "Нет высшего образования" && !data.graduation_year) {
    return (errorEl.textContent = "Выберите год выпуска.");
  }

  if (!data.specialty) return (errorEl.textContent = "Выберите специальность.");
  if (data.specialty === "Другое" && !data.specialty_other?.trim()) {
    return (errorEl.textContent = "Укажите специальность (Другое).");
  }

  if (!data.internship_direction) return (errorEl.textContent = "Выберите направление стажировки.");

  if (data.internship_direction === "IT") {
    if (data.online_courses && data.online_courses !== "Не проходил(а)") {
      if (!data.online_course_year) return (errorEl.textContent = "Выберите год окончания онлайн-курса.");
      if (data.online_course_year === "Другой" && !data.online_course_year_other?.trim()) {
        return (errorEl.textContent = "Укажите год окончания онлайн-курса (Другой).");
      }
    }
  }

  if (!data.priority1) return (errorEl.textContent = "Выберите приоритетное направление №1.");
  if (!data.priority2) return (errorEl.textContent = "Выберите приоритетное направление №2.");

  if (!data.hours_per_week) return (errorEl.textContent = "Выберите количество часов.");
  if (!data.ready_6_months) return (errorEl.textContent = "Укажите готовность к стажировке на 6 месяцев.");

  // Добавим tg данные (опционально)
  const user = window.Telegram?.WebApp?.initDataUnsafe?.user;
  // Подпись Telegram WebApp (нужна для серверной проверки)
  data.tg_init_data = window.Telegram?.WebApp?.initData || "";
  if (user?.id) data.tg_user_id = String(user.id);
  if (user?.username) data.tg_username = String(user.username);
  // start_param (если миниапп открыт по ссылке вида ...?startapp=XXX)
  const sp = window.Telegram?.WebApp?.initDataUnsafe?.start_param;
  if (sp) data.tg_start_param = String(sp);

  try {
    // platform meta
  data.platform = APP_CONTEXT.platform;

  if (APP_CONTEXT.platform === "telegram" && APP_CONTEXT.tg) {
    data.tg_init_data = APP_CONTEXT.tg.initData || "";
    const u = APP_CONTEXT.tg.user;
    if (u?.id) data.tg_user_id = String(u.id);
    if (u?.username) data.tg_username = String(u.username);
    if (APP_CONTEXT.tg.start_param) data.tg_start_param = String(APP_CONTEXT.tg.start_param);
  }

  if (APP_CONTEXT.platform === "vk") {
    // launch params are needed for server-side signature verification
    data.vk_launch_params = APP_CONTEXT.vk?.launchParamsRaw || "";
    const vu = APP_CONTEXT.vk?.user;
    if (vu?.id) data.vk_user_id = String(vu.id);
  }

  const res = await fetch(FUNCTION_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data),
    });

    const out = await res.json().catch(() => null);

    if (!res.ok || !out?.ok) {
      throw new Error(out?.error || out?.details || `HTTP ${res.status}`);
    }

    resultEl.textContent = "Данные отправлены ✅";
    clearState();
  } catch (err) {
    console.error(err);
    const msg = (err && err.message) ? err.message : String(err);
    // В Safari/Telegram WebView сетевые/CORS проблемы часто выглядят как "Load failed"
    if (/Load failed|Failed to fetch/i.test(msg)) {
      errorEl.textContent = "Ошибка отправки: Load failed. Обычно это CORS/Origin или недоступность функции. Проверь ALLOWED_ORIGINS в функции и что URL доступен по HTTPS.";
    } else {
      errorEl.textContent = "Ошибка отправки: " + msg;
    }
  }
});
/* =========================================================
   Init
========================================================= */
setBlockVisible(cityOtherBlock, false);
setBlockVisible(timezoneDiffBlock, false);
setBlockVisible(specialtyOtherBlock, false);
setBlockVisible(onlineCoursesBlock, false);
setBlockVisible(onlineCourseYearBlock, false);
setBlockVisible(onlineCourseYearOtherBlock, false);
setBlockVisible(prioritiesBlock, false);
setBlockVisible(priority1Desc, false);
setBlockVisible(priority2Desc, false);

resetSelect(priority1, "— Выберите —");
resetSelect(priority2, "— Выберите —");




/* =========================================================
   Pretty date picker (без внешних библиотек)
========================================================= */
(function initBirthDatePicker() {
  const day = document.getElementById("birth_day");
  const month = document.getElementById("birth_month");
  const year = document.getElementById("birth_year");
  const hidden = document.getElementById("birth_date");

  if (!day || !month || !year || !hidden) return;

  // Заполняем дни 1..31
  for (let d = 1; d <= 31; d++) {
    const opt = document.createElement("option");
    opt.value = String(d).padStart(2, "0");
    opt.textContent = String(d);
    day.appendChild(opt);
  }

  // Месяцы
  const months = [
    ["01", "Январь"], ["02", "Февраль"], ["03", "Март"], ["04", "Апрель"],
    ["05", "Май"], ["06", "Июнь"], ["07", "Июль"], ["08", "Август"],
    ["09", "Сентябрь"], ["10", "Октябрь"], ["11", "Ноябрь"], ["12", "Декабрь"]
  ];
  months.forEach(([val, name]) => {
    const opt = document.createElement("option");
    opt.value = val;
    opt.textContent = name;
    month.appendChild(opt);
  });

  // Годы: текущий-14 ... текущий-80
  const now = new Date();
  const currentYear = now.getFullYear();
  const maxY = currentYear - 14;
  const minY = currentYear - 80;

  for (let y = maxY; y >= minY; y--) {
    const opt = document.createElement("option");
    opt.value = String(y);
    opt.textContent = String(y);
    year.appendChild(opt);
  }

  function daysInMonth(yyyy, mm) {
    return new Date(Number(yyyy), Number(mm), 0).getDate();
  }

  function clampDays() {
    if (!year.value || !month.value) return;
    const maxDay = daysInMonth(year.value, month.value);

    for (let i = 1; i < day.options.length; i++) {
      const v = Number(day.options[i].value);
      day.options[i].disabled = v > maxDay;
    }

    if (day.value && Number(day.value) > maxDay) {
      day.value = "";
    }
  }

  function syncHidden() {
    clampDays();
    if (year.value && month.value && day.value) {
      hidden.value = `${year.value}-${month.value}-${day.value}`;
    } else {
      hidden.value = "";
    }
  }

  year.addEventListener("change", syncHidden);
  month.addEventListener("change", syncHidden);
  day.addEventListener("change", syncHidden);

  // Если hidden уже заполнен — распарсим
  if (hidden.value && /^\d{4}-\d{2}-\d{2}$/.test(hidden.value)) {
    const [yy, mm, dd] = hidden.value.split("-");
    year.value = yy;
    month.value = mm;
    clampDays();
    day.value = dd;
  }
})();
